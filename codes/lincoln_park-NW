
AnnotationFileDefault=~/Data/GenCode/gencode.v28.annotation.gtf
BamDirectoryDefault=~/StarAlignments
FastqDirDefault=~/Data/GenCode/gEUVADIS_RNASeq
GenomeFileDefault=~/Data/GenCode/GRCh38.primary_assembly.genome.fa
QuantOutputDefault=~/SalQuant
QCoutputDefault=~
SampleListOutDefault=~/sample_list.txt #tricky fix this
SplicingDirectoryDefault=~/leafSplice
TranscriptFileDefault=~/Data/GenCode/gencode.v28.transcripts.fa




while :
do
    case "$1" in
    					#sorted and fixed options
      -a | --annotation) #annotation file corresponding to the genome
          AnnotationFile="$2"
	  shift 2
	  ;;
      -b | --bamdirectory) #Directory containing the star alignment files (assumes individual sample directories)
      	  BamDirectory="$2"
	  shift 2
	  ;;
      -f | --fastqdirectory) #directory containing the sample files to be processed
	  FastqDir="$2"  
	  shift 2
	  ;;
      -g | --genomefastafiles) #file path to the genome files for indexing. Must be supplied when -ri is supplied
          GenomeFiles="$2"
	  shift 2
	  ;;
      -id | --indexingdirectory) #when supplied alone, indexing has been run, and points to the index directory. When supplied with -ri, serves as output directory for indexing.
	  IndexDirectory="$2"
	  shift 2
	  ;;
      -lt | --librarytype) #directory containing the fastq files to be processed
	  LibraryType="$2"  
	  shift 2
	  ;;
      -n | --samplenumber) #number of samples you wish to process. Assumes samples are paired fastq files. Default is 89.
	  SampNum="$2"
	  shift 2
	  ;;
      -q | --quantdirectory) #directory where you'd like to send all your quantification files
          QuantOutput="$2"
	  shift 2
	  ;;
      -r | --runindexing) #Only supplied if indexing has not been run. May be supplied with -id to name output directory. Must be supplied with -g genome files path (Right now only accepts 1 genome file).
	  RunIndex="$2"
	  shift 2
	  ;;
      -s | --samplelist) #list of all samples that will be processed
	  SampleListOut="$2"
	  shift 2
	  ;;
      -sp | --splicingdirectory) 
	  SplicingDir="$2"
	  shift 2
	  ;;
      -t | --transcript)
	  TranscriptFile="$2"
	  shift 2
	  ;;
      -th | --threads) #Only supplied if indexing has not been run. May be supplied with -id to name output directory. Must be supplied with -g genome files path (Right now only accepts 1 genome file).
	  Threads="$2"
	  shift 2
	  ;;
      






      -l | --lengthmaximum) #maximum length of introns to be used in clustering
      	  LengthMaximum="$2"
	  shift 2
	  ;;
      -m | --minimumclustering) #Minimum number of reads that define a cluster
      	  MinimumClustering="$2"
	  shift 2
	  ;;
      -t | --tag) #prefix of output
      	  OutputPrefix="$2"
	  shift 2
	  ;;
      -pc | --principalcomponents) #How many PCs do you wish to generate
	  PC="$2"
	  shift 2
	  ;;
      -r | --ratiominimum) #The minimum ratio of reads that must map to support a cluster
      	  RatioMinimum="$2"
	  shift 2
	  ;;

    




                                                      #generic options
      -*) #unknown 
	  echo "Error: Unknown option: $1" >&2
	  exit 1
	  ;;
      *)  # No more options
	  shift
	  break
	  ;;
     esac
done





~/codes/list_samples --inputdirectory "${FastqDir:=$FastqDirDefault}" --outputdirectory "${SampleListOut:=SampleListOutDefault}" --samplenumber "${SampNum:=}"

~/codes/filtering/fastqc_loop --fastqdir "${FastqDir:=$FastqDirDefault}" --output "${}" --samplelist "${SampleListOut:=SampleListOutDefault}"

~/codes/star_loop --annotation "${AnnotationFile:=$AnnotationFileDefault}" --genomefastafiles "${GenomeFile:=$GenomeFileDefault}" --inputdirectory "${FastqDir:=$FastqDirDefault}" --indexingdirectory "${BamDirectory:=}" --outputdirectory "${}" --runindexing "${}" --samplelist "${SampleListOut:=SampleListOutDefault}" --threads "${}"



~/codes/leaf_loop --inputdirectory "${BamDirectory:=$BamDirectoryDefault}" --lengthmaximum "${}" --minimumclustering "${}" --prefix "${}" --principalcomponents "${}" --ratiominimum "${}" --samplelist "${SampleListOut:=SampleListOutDefault}" --outputdir "${}"
for qqnorm in ${writeleaf}*qqnorm*
do
	python3 qqnormparser.py $qqnorm
done



~/codes/salmon_loop --annotation "${AnnotationFile:=$AnnotationFileDefault}" --inputdirectory "${BamDirectory:=$BamDirectory}" --librarytype --outputdirectory "${QuantOutput:=QuantOutputDefault}" --samplelist "${SampleListOut:=SampleListOutDefault}" --transcript "${TranscriptFile:=$TranscriptFileDefault}"
~/codes/Salmon_parser.R -o "${QuantOutput:=QuantOutputDefault}"/expression_location -q "${QuantOutput:=}" -a "${AnnotationFile:=$AnnotationFileDefault}" -v "${}" -m "${}" -s "${}"



SNPparser
echo "Beginning eQTL analysis"
for i in 1:22
do
	Rscript ~/codes/MatrixEQTL.R -sg "${}" -sl "${}" -ge "${}" -gl "${}" #eqtl
done
echo "Beginning sQTL analysis"
for i in 1:22
do
	Rscript ~/codes/MatrixEQTL.R -sg "${}" -sl "${}" -ge "${}" -gl "${}" #sqtl
done
echo "complete"
